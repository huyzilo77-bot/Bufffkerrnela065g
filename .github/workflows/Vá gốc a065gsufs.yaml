name: Patch SUSFS into Samsung A06 5G Kernel

on:
  workflow_dispatch:

jobs:
  patch:
    runs-on: ubuntu-latest

    steps:
      - name: ðŸ“¥ Checkout repo
        uses: actions/checkout@v4

      - name: ðŸ“¥ Download Kernel Source (Samsung A06 5G)
        run: |
          wget -O kernel_src.zip https://github.com/huyzilo77-bot/Bufffkerrnela065g/releases/download/V1/A066B-5G.zip
          unzip kernel_src.zip
          tar -xvf Kernel.tar.gz
          ls -la

      - name: ðŸ“¤ Upload Original Kernel
        uses: actions/upload-artifact@v4
        with:
          name: kernel-original
          path: kernel-5.15

      - name: ðŸ“¥ Clone SUSFS
        run: |
          git clone -b gki-android13-5.15 https://gitlab.com/simonpunk/susfs4ksu.git susfs

      - name: ðŸ©¹ Apply SUSFS patches
        run: |
          cd kernel-5.15
          for p in ../susfs/patches/*.patch; do
            echo "Applying $p"
            patch -p1 < "$p" || true
          done
          echo "âœ… Done patching"

      - name: ðŸ“‚ Collect .rej files
        if: always()
        run: |
          mkdir -p ../rej_out
          find . -name "*.rej" -exec cp --parents {} ../rej_out/ \; || true
        working-directory: kernel-5.15

      - name: ðŸ“¤ Upload Patched Kernel
        uses: actions/upload-artifact@v4
        with:
          name: kernel-patched-susfs
          path: kernel-5.15

      - name: ðŸ“¤ Upload .rej (if any)
        uses: actions/upload-artifact@v4
        with:
          name: susfs-rejects
          path: rej_out
