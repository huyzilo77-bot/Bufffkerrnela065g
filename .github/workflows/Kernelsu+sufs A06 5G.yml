name: Build Samsung A06 5G Kernel (KernelSU + SUSFS)

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-22.04

    steps:
      - name: üì• Checkout Repo
        uses: actions/checkout@v4

      - name: ‚öôÔ∏è Install Deps & Toolchains
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            git wget curl unzip build-essential \
            bc bison flex libssl-dev \
            gcc clang lld llvm

      - name: üì• Download Samsung A06 Kernel Source
        run: |
          mkdir -p kernel-src
          cd kernel-src
          wget -q https://github.com/huyzilo77-bot/Bufffkerrnela065g/releases/download/V1/A066B-5G.zip -O kernel.zip
          unzip -q kernel.zip
          ls -lh

      - name: üå± Clone KernelSU-Next & SUSFS
        run: |
          git clone --depth=1 https://github.com/KernelSU-Next/KernelSU-Next.git KernelSU-Next
          git clone --depth=1 https://github.com/sidex15/susfs4ksu-module.git susfs

      - name: ‚ö° Apply KernelSU Patch
        run: |
          cd kernel-src/kernel-5.15
          bash ../../KernelSU-Next/scripts/apply.sh next

      - name: ‚ö° Apply SUSFS Patch
        run: |
          cd kernel-src/kernel-5.15
          patch -p1 < ../../susfs/susfs.patch || true

      - name: üîç Verify Patch Result
        run: |
          echo "üîç Checking for .rej files..."
          if find kernel-src/kernel-5.15 -name "*.rej" | grep -q .; then
            echo "‚ö†Ô∏è Found rejected patches (.rej):"
            find kernel-src/kernel-5.15 -name "*.rej"
          else
            echo "‚úÖ No .rej files, patch applied cleanly."
          fi

      - name: üíæ Save Original, Patched, Rejected
        uses: actions/upload-artifact@v4
        with:
          name: Kernel-Patched-Outputs
          path: |
            kernel-src/kernel-5.15
            kernel-src/*.rej
